static const char *purpose = "demonstrate read/write sets";
static const char *description =
    "Calculate and show read/write sets for stack variables in functions.";

#include <Rose/BinaryAnalysis/Architecture/Base.h>
#include <Rose/BinaryAnalysis/InstructionSemantics/BaseSemantics/BasicTypes.h>
#include <Rose/BinaryAnalysis/InstructionSemantics/SymbolicSemantics.h>
#include <Rose/BinaryAnalysis/Partitioner2/BasicBlock.h>
#include <Rose/BinaryAnalysis/Partitioner2/DataFlow.h>
#include <Rose/BinaryAnalysis/Partitioner2/Engine.h>
#include <Rose/BinaryAnalysis/Partitioner2/Partitioner.h>
#include <Rose/BinaryAnalysis/ReadWriteSets.h>
#include <Rose/CommandLine.h>
#include <Rose/Diagnostics.h>
#include <Rose/Initialize.h>
#include <Rose/StringUtility/Diagnostics.h>

#include <batSupport.h>

#include <stringify.h>
#include <rose_getline.h>

#include <Sawyer/FileSystem.h>

using namespace Rose;
using namespace Rose::BinaryAnalysis;
using namespace Sawyer::Message::Common;
namespace BS = Rose::BinaryAnalysis::InstructionSemantics::BaseSemantics;
namespace P2 = Rose::BinaryAnalysis::Partitioner2;
namespace Symbolic = Rose::BinaryAnalysis::InstructionSemantics::SymbolicSemantics;

struct Settings {
    std::set<std::string> functionNames;
    size_t maxIterations = 100;
    ReadWriteSets::Settings rwSets;
};

static Sawyer::Message::Facility mlog;

static Sawyer::CommandLine::Parser
createSwitchParser(Settings &settings) {
    using namespace Sawyer::CommandLine;


    SwitchGroup tool("Tool specific switches");
    tool.name("tool");

    tool.insert(Switch("function", 'f')
                .argument("name_or_address", listParser(anyParser(settings.functionNames), ","))
                .explosiveLists(true)
                .whichValue(SAVE_ALL)
                .doc("Restricts analysis to the specified functions. The @v{name_or_address} can be the name of a function ax "
                     "a string or the entry address for the function as a decimal, octal, hexadecimal or binary number. "
                     "If a value is ambiguous, it's first treated as a name and if no functio has that name it's then "
                     "treated as an address. This switch may occur multiple times and multiple comma-separated values may "
                     "be specified per occurrence."));

    Parser parser = Rose::CommandLine::createEmptyParser(purpose, description);
    parser.doc("Synopsis", "@prop{programName} [@v{switches}] @v{specimen}");
    parser.errorStream(mlog[FATAL]);
    parser.with(tool);
    parser.with(ReadWriteSets::commandLineSwitches(settings.rwSets));
    parser.with(Variables::VariableFinder::commandLineSwitches(settings.rwSets.variableFinder));
    parser.with(Rose::CommandLine::genericSwitches());
    return parser;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Testing
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

class SelfTest: public Rose::CommandLine::SelfTest {
public:
    std::string name() const override {
        return "bat-rwsets";
    }

    bool operator()() override {
        // Build the temporary input file
        Sawyer::FileSystem::TemporaryFile elfFile;
        mlog[INFO] <<"self test file is " <<elfFile.name() <<"\n";
        compileTest(elfFile);

        // Create a command-line for testing
        Settings settings;
        Sawyer::CommandLine::Parser parser = createSwitchParser(settings);
        std::array<char*, 6> args;
        args[0] = strdup("bat-rwsets-self-test");
        args[1] = strdup("--threads=1");
        args[2] = strdup("--function=CWE476_NULL_Pointer_Dereference__int_01_bad");
        args[3] = strdup("--log=none,>=error");
        args[4] = strdup(elfFile.name().c_str());
        args[5] = nullptr;

        // Parse the test command-line
        P2::Engine::Ptr engine = P2::Engine::forge(args.size()-1, args.data(), parser);
        std::vector<std::string> specimen = parser.parse(args.size()-1, args.data()).apply().unreachedArgs();
        ASSERT_always_forbid(engine->name().empty());
        ASSERT_always_forbid(specimen.empty());

        // Parse the test ELF file
        P2::Partitioner::Ptr partitioner = engine->partition(specimen);
        ASSERT_always_not_null(partitioner);
        const std::vector<P2::Function::Ptr> functions =
            Bat::selectFunctionsByNameOrAddress(partitioner->functions(), settings.functionNames, mlog[WARN]);
        ASSERT_always_require(functions.size() == 1);

        // Run the analysis and generate results
        auto rwSets = ReadWriteSets::instance(partitioner, settings.rwSets);
        rwSets->analyze(functions[0]);
        std::ostringstream result;
        for (const Variables::StackVariable &svar: rwSets->localVariables()) {
            result <<svar <<"\n";
            for (const Variables::InstructionAccess &ia: svar.instructionsAccessing())
                result <<"  " <<ia <<"\n";
        }

        // Check that the result is as expected
        const std::string expectedResult =
            "local-variable \"di\" (loc=sp-0x30<-48>, size=4, type=UNKNOWN)\n"
            "  write at instruction 0x00001454\n"
            "local-variable \"ci\" (loc=sp-0x2c<-44>, size=0xc<12>, type=UNKNOWN)\n"
            "  write at instruction 0x00001451\n"
            "local-variable \"fe\" (loc=sp-0x20<-32>, size=0x10<16>, type=UNKNOWN)\n"
            "  write at instruction 0x00001438\n"
            "local-variable \"g\" (loc=sp-0x10<-16>, size=8, type=UNKNOWN)\n"
            "  write at instruction 0x00001442\n"
            "  read at instruction 0x00001449\n"
            "local-variable \"d\" (loc=sp-8, size=4, type=UNKNOWN)\n"
            "  write at instruction 0x00001434\n"
            "  read at instruction 0x0000145d\n"
            "local-variable \"c\" (loc=sp-4, size=4, type=FRAME_POINTER)\n"
            "  implied access\n"
            "  write at instruction 0x00001431\n"
            "  read at instruction 0x00001460\n"
            "local-variable \"y\" (loc=sp+0, size=4, type=RETURN_ADDRESS)\n"
            "  implied access\n"
            "  read at instruction 0x00001461\n";
        if (result.str() != expectedResult) {
            mlog[ERROR] <<"self test failed:\n";

            // Show the test command and arrange to keep the test specimen
            mlog[ERROR] <<"  command that failed:\n"
                        <<"    |" <<StringUtility::bourneEscape(Sawyer::thisExecutableName());
            for (size_t i = 1; i < args.size() - 1; ++i)
                mlog[ERROR] <<" \\\n    |    " <<StringUtility::bourneEscape(args[i]);
            mlog[ERROR] <<"\n";
            elfFile.keep(true);

            // Expected and obtained answers
            mlog[ERROR] <<"  expected:\n"
                        <<StringUtility::prefixLines(expectedResult, "    |")
                        <<"  but got:\n"
                        <<StringUtility::prefixLines(result.str(), "    |");

            // diff output might more clearly show the difference
            Sawyer::FileSystem::TemporaryFile diff1, diff2;
            diff1.stream() <<expectedResult <<std::endl;
            diff2.stream() <<result.str() <<std::endl;
            if (FILE *diff = popen(("diff -u " +
                                    StringUtility::bourneEscape(diff1.name().string()) + " " +
                                    StringUtility::bourneEscape(diff2.name().string())).c_str(),
                                   "r")) {
                mlog[ERROR] <<"  difference:\n";
                while (true) {
                    const std::string line = rose_getline(diff);
                    if (line.empty()) {
                        break;
                    } else {
                        mlog[ERROR] <<"    |" <<line;
                    }
                }
            }

            return false;
        }

        // Cleanup
        for (char* &arg: args) {
            free(arg);
            arg = nullptr;
        }
        return true;
    }

    // Compile the following source code and create an ELF file as the result.
    //    |/* TEMPLATE GENERATED TESTCASE FILE
    //    |Filename: CWE476_NULL_Pointer_Dereference__int_01.c
    //    |Label Definition File: CWE476_NULL_Pointer_Dereference.label.xml
    //    |Template File: sources-sinks-01.tmpl.c
    //    |*/
    //    |/*
    //    | * @description
    //    | * CWE: 476 NULL Pointer Dereference
    //    | * BadSource:  Set data to NULL
    //    | * GoodSource: Initialize data
    //    | * Sinks:
    //    | *    GoodSink: Check for NULL before attempting to print data
    //    | *    BadSink : Print data
    //    | * Flow Variant: 01 Baseline
    //    | *
    //    | * */
    //    |
    //    |#include "std_testcase.h"
    //    |
    //    |#include <wchar.h>
    //    |
    //    |#ifndef OMITBAD
    //    |
    //    |void CWE476_NULL_Pointer_Dereference__int_01_bad()
    //    |{
    //    |    int * data;
    //    |    /* POTENTIAL FLAW: Set data to NULL */
    //    |    data = NULL;
    //    |    /* POTENTIAL FLAW: Attempt to use data, which may be NULL */
    //    |    printIntLine(*data);
    //    |}
    //    |
    //    |#endif /* OMITBAD */
    //    |
    //    |#ifndef OMITGOOD
    //    |
    //    |/* goodG2B uses the GoodSource with the BadSink */
    //    |static void goodG2B()
    //    |{
    //    |    int * data;
    //    |    int tmpData = 5;
    //    |    /* FIX: Initialize data */
    //    |    {
    //    |        data = &tmpData;
    //    |    }
    //    |    /* POTENTIAL FLAW: Attempt to use data, which may be NULL */
    //    |    printIntLine(*data);
    //    |}
    //    |
    //    |/* goodB2G uses the BadSource with the GoodSink */
    //    |static void goodB2G()
    //    |{
    //    |    int * data;
    //    |    /* POTENTIAL FLAW: Set data to NULL */
    //    |    data = NULL;
    //    |    /* FIX: Check for NULL before attempting to print data */
    //    |    if (data != NULL)
    //    |    {
    //    |        printIntLine(*data);
    //    |    }
    //    |    else
    //    |    {
    //    |        printLine("data is NULL");
    //    |    }
    //    |}
    //    |
    //    |void CWE476_NULL_Pointer_Dereference__int_01_good()
    //    |{
    //    |    goodG2B();
    //    |    goodB2G();
    //    |}
    //    |
    //    |#endif /* OMITGOOD */
    //    |
    //    |/* Below is the main(). It is only used when building this testcase on
    //    |   its own for testing or for building a binary to use in testing binary
    //    |   analysis tools. It is not used when compiling all the testcases as one
    //    |   application, which is how source code analysis tools are tested. */
    //    |
    //    |#ifdef INCLUDEMAIN
    //    |
    //    |int main(int argc, char * argv[])
    //    |{
    //    |    /* seed randomness */
    //    |    srand( (unsigned)time(NULL) );
    //    |#ifndef OMITGOOD
    //    |    printLine("Calling good()...");
    //    |    CWE476_NULL_Pointer_Dereference__int_01_good();
    //    |    printLine("Finished good()");
    //    |#endif /* OMITGOOD */
    //    |#ifndef OMITBAD
    //    |    printLine("Calling bad()...");
    //    |    CWE476_NULL_Pointer_Dereference__int_01_bad();
    //    |    printLine("Finished bad()");
    //    |#endif /* OMITBAD */
    //    |    return 0;
    //    |}
    //    |
    //    |#endif
    //    |
    //
    // Since we want reproducible results for this self-test, instead of running some unspecified C compiler each time, we'll do
    // it once and store the result here. The result is the output from the "hexdump" or "hd" command run on the ELF file. Use
    // this command to generate the data that goes here:
    //
    //   hexdump -ve'56/1 "%02x" "\n"' the_executable |sed 's/^/            "/; s/ *$/"/'
    //
    void compileTest(Sawyer::FileSystem::TemporaryFile &elfFile) {
        std::istringstream hexadecimal(
            "7f454c460101010000000000000000000300030001000000f012000034000000184d000000000000340020000c0028002400230006000000"
            "3400000034000000340000008001000080010000040000000400000003000000b4010000b4010000b4010000130000001300000004000000"
            "01000000010000000000000000000000000000007807000078070000040000000010000001000000001000000010000000100000500f0000"
            "500f0000050000000010000001000000002000000020000000200000080a0000080a0000040000000010000001000000842e0000843e0000"
            "843e00008c0100009c0100000600000000100000020000008c2e00008c3e00008c3e00000001000000010000060000000400000004000000"
            "c8010000c8010000c80100006000000060000000040000000400000053e57464ec010000ec010000ec0100001c0000001c00000004000000"
            "0400000050e574649c2000009c2000009c200000d4010000d4010000040000000400000051e5746400000000000000000000000000000000"
            "00000000060000001000000052e57464842e0000843e0000843e00007c0100007c01000004000000010000002f6c69622f6c642d6c696e75"
            "782e736f2e320000040000001400000003000000474e5500413ddd5e5c17390176f69f98e999d61f633bfe58040000000c00000005000000"
            "474e5500020000c00400000003000000040000001000000001000000474e550000000000030000000200000000000000020000001a000000"
            "010000000500000000200020000000001a000000ad4be3c0000000000000000000000000000000009f000000000000000000000012000000"
            "67000000000000000000000012000000110000000000000000000000200000003a0100000000000000000000120000002001000000000000"
            "00000000120000005301000000000000000000001200000047000000000000000000000012000000f5000000000000000000000012000000"
            "580100000000000000000000120000007d000000000000000000000012000000390100000000000000000000120000002a01000000000000"
            "0000000022000000fa0000000000000000000000120000000b010000000000000000000012000000f0000000000000000000000012000000"
            "b1010000000000000000000020000000da00000000000000000000001200000041010000000000000000000012000000e000000000000000"
            "0000000012000000db000000000000000000000012000000b40000000000000000000000120000005a000000000000000000000012000000"
            "900000000000000000000000120000002d00000000000000000000002000000012010000000000000000000012000000cb00000004200000"
            "0400000011001200006c6962707468726561642e736f2e30005f49544d5f64657265676973746572544d436c6f6e655461626c65005f4954"
            "4d5f7265676973746572544d436c6f6e655461626c6500707468726561645f6d757465785f696e697400707468726561645f6a6f696e0070"
            "7468726561645f6d757465785f64657374726f7900707468726561645f6d757465785f6c6f636b00707468726561645f6372656174650070"
            "7468726561645f6d757465785f756e6c6f636b00707468726561645f65786974006c6962632e736f2e36005f494f5f737464696e5f757365"
            "64007372616e64005f5f69736f6339395f737363616e6600707574730074696d65005f5f69736f6339395f73777363616e66006d616c6c6f"
            "63005f5f63747970655f625f6c6f6300697377786469676974005f5f6378615f66696e616c697a6500777072696e7466005f5f6c6962635f"
            "73746172745f6d61696e0066726565005f5f737461636b5f63686b5f6661696c00474c4942435f322e3300474c4942435f322e3700474c49"
            "42435f322e312e3300474c4942435f322e3200474c4942435f322e3400474c4942435f322e3000474c4942435f322e31005f5f676d6f6e5f"
            "73746172745f5f00000002000200000003000300030002000300040002000500060007000300030000000300030007000300020002000800"
            "000009000100000001000600c100000010000000700000001369690d0000090069010000100000001769690d000007007301000010000000"
            "731f6909000006007d010000100000001269690d0000050089010000100000001469690d0000040093010000100000001069690d00000300"
            "9d01000000000000010002000100000010000000000000001169690d00000800a7010000100000001069690d000002009d01000000000000"
            "843e000008000000883e000008000000f83f0000080000000440000008000000ec3f000006030000f03f0000060c0000f43f000006100000"
            "fc3f000006180000983f0000070100009c3f000007020000a03f000007040000a43f000007050000a83f000007060000ac3f000007070000"
            "b03f000007080000b43f000007090000b83f0000070a0000bc3f0000070b0000c03f0000070d0000c43f0000070e0000c83f0000070f0000"
            "cc3f000007110000d03f000007120000d43f000007130000d83f000007140000dc3f000007150000e03f000007160000e43f000007170000"
            "e83f000007190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000f30f1efb5383ec08e82303000081c37f2f00008b836800000085c07402ffd083c4085bc3000000000000000000000000"
            "ffb304000000ffa3080000000f1f4000f30f1efb6800000000e9e2ffffff6690f30f1efb6808000000e9d2ffffff6690f30f1efb68100000"
            "00e9c2ffffff6690f30f1efb6818000000e9b2ffffff6690f30f1efb6820000000e9a2ffffff6690f30f1efb6828000000e992ffffff6690"
            "f30f1efb6830000000e982ffffff6690f30f1efb6838000000e972ffffff6690f30f1efb6840000000e962ffffff6690f30f1efb68480000"
            "00e952ffffff6690f30f1efb6850000000e942ffffff6690f30f1efb6858000000e932ffffff6690f30f1efb6860000000e922ffffff6690"
            "f30f1efb6868000000e912ffffff6690f30f1efb6870000000e902ffffff6690f30f1efb6878000000e9f2feffff6690f30f1efb68800000"
            "00e9e2feffff6690f30f1efb6888000000e9d2feffff6690f30f1efb6890000000e9c2feffff6690f30f1efb6898000000e9b2feffff6690"
            "f30f1efb68a0000000e9a2feffff6690f30f1efbffa364000000660f1f440000f30f1efbffa30c000000660f1f440000f30f1efbffa31000"
            "0000660f1f440000f30f1efbffa314000000660f1f440000f30f1efbffa318000000660f1f440000f30f1efbffa31c000000660f1f440000"
            "f30f1efbffa320000000660f1f440000f30f1efbffa324000000660f1f440000f30f1efbffa328000000660f1f440000f30f1efbffa32c00"
            "0000660f1f440000f30f1efbffa330000000660f1f440000f30f1efbffa334000000660f1f440000f30f1efbffa338000000660f1f440000"
            "f30f1efbffa33c000000660f1f440000f30f1efbffa340000000660f1f440000f30f1efbffa344000000660f1f440000f30f1efbffa34800"
            "0000660f1f440000f30f1efbffa34c000000660f1f440000f30f1efbffa350000000660f1f440000f30f1efbffa354000000660f1f440000"
            "f30f1efbffa358000000660f1f440000f30f1efbffa35c000000660f1f440000f30f1efb31ed5e89e183e4f0505452e82200000081c3882c"
            "00008d8384dfffff508d8314dfffff505156ffb36c000000e85bfffffff48b1c24c36690669066908b1c24c3669066906690669066906690"
            "e8e400000081c2472c00008d8a840000008d828400000039c8741d8b826000000085c074135589e583ec1451ffd083c410c9c38d74260090"
            "c38db42600000000e8a400000081c2072c00005589e5538d8a840000008d828400000083ec0429c889c3c1e81fc1fb0201d8d1f874148b92"
            "7000000085d2740a83ec085051ffd283c4108b5dfcc9c38db426000000006690f30f1efb5589e553e853ffffff81c3af2b000083ec0480bb"
            "840000000075278b836400000085c0741183ec0cffb378000000e889fdffff83c410e831ffffffc68384000000018b5dfcc9c38d74260090"
            "f30f1efbe957ffffff8b1424c3f30f1efb5589e55383ec14e894000000054f2b0000c745f4000000008b55f48b1283ec0c5289c3e8e50000"
            "0083c410908b5dfcc9c3f30f1efb8d4c240483e4f0ff71fc5589e55351e8b6feffff81c3122b000083ec0c6a00e876fdffff83c41083ec0c"
            "50e8dafdffff83c41083ec0c8d837ce0ffff50e82d00000083c410e87dffffff83ec0c8d838de0ffff50e81600000083c410b8000000008d"
            "65f8595b5d8d61fcc38b0424c3f30f1efb5589e55383ec04e8ecffffff05a72a0000837d0800741083ec0cff750889c3e863fdffff83c410"
            "908b5dfcc9c3f30f1efb5589e55383ec04e8bbffffff05762a0000837d0800741783ec08ff75088d909ce0ffff5289c3e8fbfcffff83c410"
            "908b5dfcc9c3f30f1efb5589e55383ec04e883ffffff053e2a000083ec08ff75088d90b0e0ffff5289c3e859fcffff83c410908b5dfcc9c3"
            "f30f1efb5589e55383ec14e851ffffff050c2a00008b5508668955f40fbf55f483ec08528d90b4e0ffff5289c3e81efcffff83c410908b5d"
            "fcc9c3f30f1efb5589e55383ec04e816ffffff05d1290000d9450883ec048d6424f8dd1c248d90b9e0ffff5289c3e8e5fbffff83c410908b"
            "5dfcc9c3f30f1efb5589e55383ec04e8ddfeffff059829000083ec08ff75088d90bde0ffff5289c3e8b3fbffff83c410908b5dfcc9c3f30f"
            "1efb5589e55383ec14e8abfeffff05662900008b55088955f08b550c8955f483ec04ff75f4ff75f08d90c2e0ffff5289c3e872fbffff83c4"
            "10908b5dfcc9c3f30f1efb5589e55383ec04e86afeffff052529000083ec08ff75088d90c8e0ffff5289c3e840fbffff83c410908b5dfcc9"
            "c3f30f1efb5589e55383ec14e838feffff05f32800008b55088855f40fbe55f483ec08528d90cde0ffff5289c3e806fbffff83c410908b5d"
            "fcc9c3f30f1efb5589e55383ec14e8fefdffff05b9280000658b0d14000000894df431c98b55088955ecc745f00000000083ec088d55ec52"
            "8d90d3e0ffff5289c3e8bafaffff83c410908b45f4653305140000007405e8050800008b5dfcc9c3f30f1efb5589e55383ec04e8a1fdffff"
            "055c28000083ec08ff75088d90d8e0ffff5289c3e877faffff83c410908b5dfcc9c3f30f1efb5589e55383ec14e86ffdffff052a2800008b"
            "55088855f40fb655f483ec08528d90cde0ffff5289c3e83dfaffff83c410908b5dfcc9c3f30f1efb5589e55383ec14e835fdffff05f02700"
            "008b55088955f08b550c8955f483ec04ff75f4ff75f08d90dce0ffff5289c3e8fcf9ffff83c410908b5dfcc9c3f30f1efb5589e55383ec04"
            "e8f4fcffff05af2700008b55088b4a048b55088b1283ec0451528d90e0e0ffff5289c3e8c0f9ffff83c410908b5dfcc9c3f30f1efb5589e5"
            "5383ec14e817fbffff81c373270000c745f400000000eb258b55088b45f401d00fb6000fb6c083ec08508d83eae0ffff50e87af9ffff83c4"
            "108345f4018b45f43b450c72d383ec0c8d83efe0ffff50e8fcf9ffff83c410908b5dfcc9c3f30f1efb5589e55383ec24e8b3faffff81c30f"
            "2700008b45088945e48b45108945e065a1140000008945f431c0c745f000000000eb358b45f08d14008b45e001c283ec048d45ec508d83ea"
            "e0ffff5052e8cef9ffff83c4108b4dec8b55e48b45f001d089ca88108345f0018b45f03b450c735ce8fbf9ffff8b008b55f08d0c128b55e0"
            "01ca0fb6120fbed201d201d00fb7000fb7c0250010000085c07431e8d0f9ffff8b008b55f001d28d4a018b55e001ca0fb6120fbed201d201"
            "d00fb7000fb7c0250010000085c00f8567ffffff8b45f08b4df465330d140000007405e8d00500008b5dfcc9c3f30f1efb5589e55383ec24"
            "e8cbf9ffff81c3272600008b45088945e48b45108945e065a1140000008945f431c0c745f000000000eb398b45f08d14c5000000008b45e0"
            "01c283ec048d45ec508d83f0e0ffff5052e892f8ffff83c4108b4dec8b55e48b45f001d089ca88108345f0018b45f03b450c73458b45f08d"
            "14c5000000008b45e001d08b0083ec0c50e8eaf7ffff83c41085c074248b45f0c1e0038d50048b45e001d08b0083ec0c50e8caf7ffff83c4"
            "1085c00f857affffff8b45f08b4df465330d140000007405e8fb0400008b5dfcc9c3f30f1efb5589e5e89bfaffff0556250000b801000000"
            "5dc3f30f1efb5589e5e883faffff053e250000b8000000005dc3f30f1efb5589e55383ec04e867faffff052225000089c3e82af8ffff99c1"
            "ea1f01d083e00129d083c4045b5dc3f30f1efb5589e5e83efaffff05f9240000905dc3f30f1efb5589e5e82afaffff05e5240000905dc3f3"
            "0f1efb5589e5e816faffff05d1240000905dc3f30f1efb5589e5e802faffff05bd240000905dc3f30f1efb5589e5e8eef9ffff05a9240000"
            "905dc3f30f1efb5589e5e8daf9ffff0595240000905dc3f30f1efb5589e5e8c6f9ffff0581240000905dc3f30f1efb5589e5e8b2f9ffff05"
            "6d240000905dc3f30f1efb5589e5e89ef9ffff0559240000905dc3f30f1efb5589e5e88af9ffff0545240000905dc3f30f1efb5589e5e876"
            "f9ffff0531240000905dc3f30f1efb5589e5e862f9ffff051d240000905dc3f30f1efb5589e5e84ef9ffff0509240000905dc3f30f1efb55"
            "89e5e83af9ffff05f5230000905dc3f30f1efb5589e5e826f9ffff05e1230000905dc3f30f1efb5589e5e812f9ffff05cd230000905dc3f3"
            "0f1efb5589e5e8fef8ffff05b9230000905dc3f30f1efb5589e5e8eaf8ffff05a5230000905dc3f30f1efb5589e55383ec14e831f7ffff81"
            "c38d2300008b45088945f48b45f48b40048b55f48b520883ec0c52ffd083c41083ec0c6a00e886f6fffff30f1efb5589e55383ec24e8f6f6"
            "ffff81c3522300008b45088945e48b450c8945e08b45108945dc65a1140000008945f431c08b45dcc7000000000083ec0c6a0ce8e0f5ffff"
            "83c4108945f0837df0007507b800000000eb588b45f08b55e48950048b45f08b55e0895008ff75f08d8363dcffff506a008d45ec50e826f6"
            "ffff83c41085c0741583ec0cff75f0e824f5ffff83c410b800000000eb158b55ec8b45f089108b45dc8b55f08910b8010000008b4df46533"
            "0d140000007405e8340200008b5dfcc9c3f30f1efb5589e55383ec24e8d0f7ffff058b2200008b55088955e4658b1d14000000895df431db"
            "8b55e48b1283ec088d4df0515289c3e894f5ffff83c41085c07407b800000000eb05b8010000008b4df465330d140000007405e8d0010000"
            "8b5dfcc9c3f30f1efb5589e55383ec04e86cf7ffff052722000083ec0cff750889c3e869f4ffff83c410b8010000008b5dfcc9c3f30f1efb"
            "5589e55383ec14e89cf5ffff81c3f8210000c745f4000000008b4508c7000000000083ec0c6a18e89cf4ffff83c4108945f4837df4007507"
            "b800000000eb378b45f483ec086a0050e81bf4ffff83c41085c0741583ec0cff7508e8f9f3ffff83c410b800000000eb0d8b45088b55f489"
            "10b8010000008b5dfcc9c3f30f1efb5589e55383ec04e8bef6ffff05792100008b550883ec0c5289c3e8faf3ffff83c410908b5dfcc9c3f3"
            "0f1efb5589e55383ec04e892f6ffff054d2100008b550883ec0c5289c3e84ef3ffff83c410908b5dfcc9c3f30f1efb5589e55383ec04e8c5"
            "f4ffff81c3212100008b450883ec0c50e833f3ffff83c41083ec0cff7508e855f3ffff83c410908b5dfcc9c3669066906690669066906690"
            "f30f1efb55e86b00000081c5e220000057565383ec0c89eb8b7c2428e83ff1ffff8d9dfcfeffff8d85f8feffff29c3c1fb02742931f68db4"
            "26000000008d760083ec0457ff74242cff74242cff94b5f8feffff83c60183c41039f375e383c40c5b5e5f5dc38db426000000008d742600"
            "f30f1efbc38b2c24c366906690669090f30f1efb53e806f4ffff81c36220000083ec08e8d8f2fffff30f1efb5383ec08e8ebf3ffff81c347"
            "20000083c4085bc3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "00000000000000000000000000000000030000000100020043616c6c696e672062616428292e2e2e0046696e697368656420626164282900"
            "250000006c000000730000000a0000000000000025640a002568640a0025660a00256c640a00256c6c640a00257a750a00253032780a0025"
            "6c730a0025750a0025670a002564202d2d2025640a0025303278000025000000300000003200000078000000000000000100000000000000"
            "05000000011b033bd00100003900000094efffff00020000f4f0ffff2402000004f1ffff3802000054f2ffffec01000091f3ffff4c020000"
            "c6f3ffff7002000035f4ffffa402000039f4ffffb80200006af4ffffdc020000a2f4ffff00030000d4f4ffff240300000ff5ffff48030000"
            "48f5ffff6c0300007af5ffff90030000bbf5ffffb4030000edf5ffffd803000027f6fffffc03000084f6ffff20040000b6f6ffff44040000"
            "f0f6ffff6804000031f7ffff8c0400006df7ffffb0040000d1f7ffffd4040000b9f8fffff80400008ef9ffff1c050000a6f9ffff3c050000"
            "bef9ffff5c050000ebf9ffff80050000fff9ffffa005000013faffffc005000027faffffe00500003bfaffff000600004ffaffff20060000"
            "63faffff4006000077faffff600600008bfaffff800600009ffaffffa0060000b3faffffc0060000c7faffffe0060000dbfaffff00070000"
            "effaffff2007000003fbffff4007000017fbffff600700002bfbffff800700003ffbffffa007000053fbffffc00700008efbffffdc070000"
            "55fcffff00080000b9fcffff24080000e8fcffff4808000067fdffff6c08000093fdffff90080000bffdffffb408000004feffffd8080000"
            "74feffff2409000079feffff3809000084feffff4c0900001400000000000000017a5200017c08011b0c040488010000100000001c000000"
            "60f0ffff3a0000000044070820000000300000008cedffff60010000000e08460e0c4a0f0b740478003f1a392a3224221000000054000000"
            "c8eeffff10000000000000001000000068000000c4eeffff5001000000000000200000007c0000003df1ffff3500000000450e088502420d"
            "0544830369c5c30c0404000030000000a00000004ef1ffff6f00000000480c0100471005027500440f03757806100302757c0256c10c0100"
            "41c341c5430c040410000000d400000089f1ffff040000000000000020000000e800000079f1ffff3100000000450e088502420d05448303"
            "65c5c30c04040000200000000c01000086f1ffff3800000000450e088502420d054483036cc5c30c0404000020000000300100009af1ffff"
            "3200000000450e088502420d0544830366c5c30c040400002000000054010000a8f1ffff3b00000000450e088502420d054483036fc5c30c"
            "040400002000000078010000bff1ffff3900000000450e088502420d054483036dc5c30c04040000200000009c010000d4f1ffff32000000"
            "00450e088502420d0544830366c5c30c0404000020000000c0010000e2f1ffff4100000000450e088502420d0544830375c5c30c04040000"
            "20000000e4010000fff1ffff3200000000450e088502420d0544830366c5c30c0404000020000000080200000df2ffff3a00000000450e08"
            "8502420d054483036ec5c30c04040000200000002c02000023f2ffff5d00000000450e088502420d054483030251c5c30c04040020000000"
            "500200005cf2ffff3200000000450e088502420d0544830366c5c30c0404000020000000740200006af2ffff3a00000000450e088502420d"
            "054483036ec5c30c04040000200000009802000080f2ffff4100000000450e088502420d0544830375c5c30c0404000020000000bc020000"
            "9df2ffff3c00000000450e088502420d0544830370c5c30c0404000020000000e0020000b5f2ffff6400000000450e088502420d05448303"
            "0258c5c30c0404002000000004030000f5f2ffffe800000000450e088502420d0544830302dcc5c30c0404002000000028030000b9f3ffff"
            "d500000000450e088502420d0544830302c9c5c30c0404001c0000004c0300006af4ffff1800000000450e088502420d0550c50c04040000"
            "1c0000006c03000062f4ffff1800000000450e088502420d0550c50c04040000200000008c0300005af4ffff2d00000000450e088502420d"
            "0544830360c341c50c0404001c000000b003000063f4ffff1400000000450e088502420d054cc50c040400001c000000d003000057f4ffff"
            "1400000000450e088502420d054cc50c040400001c000000f00300004bf4ffff1400000000450e088502420d054cc50c040400001c000000"
            "100400003ff4ffff1400000000450e088502420d054cc50c040400001c0000003004000033f4ffff1400000000450e088502420d054cc50c"
            "040400001c0000005004000027f4ffff1400000000450e088502420d054cc50c040400001c000000700400001bf4ffff1400000000450e08"
            "8502420d054cc50c040400001c000000900400000ff4ffff1400000000450e088502420d054cc50c040400001c000000b004000003f4ffff"
            "1400000000450e088502420d054cc50c040400001c000000d0040000f7f3ffff1400000000450e088502420d054cc50c040400001c000000"
            "f0040000ebf3ffff1400000000450e088502420d054cc50c040400001c00000010050000dff3ffff1400000000450e088502420d054cc50c"
            "040400001c00000030050000d3f3ffff1400000000450e088502420d054cc50c040400001c00000050050000c7f3ffff1400000000450e08"
            "8502420d054cc50c040400001c00000070050000bbf3ffff1400000000450e088502420d054cc50c040400001c00000090050000aff3ffff"
            "1400000000450e088502420d054cc50c040400001c000000b0050000a3f3ffff1400000000450e088502420d054cc50c040400001c000000"
            "d005000097f3ffff1400000000450e088502420d054cc50c0404000018000000f00500008bf3ffff3b00000000450e088502420d05448303"
            "200000000c060000aaf3ffffc700000000450e088502420d0544830302bbc5c30c04040020000000300600004df4ffff6400000000450e08"
            "8502420d054483030258c5c30c04040020000000540600008df4ffff2f00000000450e088502420d0544830363c5c30c0404000020000000"
            "7806000098f4ffff7f00000000450e088502420d054483030273c5c30c040400200000009c060000f3f4ffff2c00000000450e088502420d"
            "0544830360c5c30c0404000020000000c0060000fbf4ffff2c00000000450e088502420d0544830360c5c30c0404000020000000e4060000"
            "03f5ffff3900000000450e088502420d054483036dc5c30c04040000480000000807000024f5ffff6500000000450e0885024c0e0c870341"
            "0e108604410e148305430e206d0e24410e28440e2c440e304d0e20470e1441c30e1041c60e0c41c70e0841c50e0400001000000054070000"
            "48f5ffff0500000000000000100000006807000039f5ffff0400000000000000180000007c07000030f5ffff1800000000450e0883024e0e"
            "1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
            "00000000000000000000000000000000000000000000000000000000000000000000000020140000d0130000010000000100000001000000"
            "c10000000c000000001000000d000000381f000019000000843e00001b000000040000001a000000883e00001c00000004000000f5feff6f"
            "2802000005000000f803000006000000480200000a000000c00100000b000000100000001500000000000000030000008c3f000002000000"
            "a8000000140000001100000017000000d00600001100000090060000120000004000000013000000080000001e00000008000000fbffff6f"
            "01000008feffff6ff0050000ffffff6f02000000f0ffff6fb8050000faffff6f040000000000000000000000000000000000000000000000"
            "00000000000000000000000000000000000000008c3e00000000000000000000401000005010000060100000701000008010000090100000"
            "a0100000b0100000c0100000d0100000e0100000f01000000011000010110000201100003011000040110000501100006011000070110000"
            "801100000000000000000000000000006214000000000000000000000440000001000000050000004743433a20285562756e747520392e33"
            "2e302d31377562756e7475317e32302e30342920392e332e30004743433a20285562756e747520392e332e302d31307562756e7475322920"
            "392e332e30001c0000000200000000000400000000002d140000a400000000000000000000002704000004000000000004018e0000000c4f"
            "000000760300002d140000a400000000000000023400000002d117310000000304070a020000030106f60100000438000000030108ed0100"
            "000302079802000003040705020000030106ef0100000302052a000000050405696e740004670000000285010000032f2c7f000000030805"
            "5b010000030807000200000212030000039819990000000304056001000002e502000003991b730000000604070438000000080000000094"
            "0431083b020000098700000004330767000000000935020000043609ae00000004093a010000043709ae000000080944030000043809ae00"
            "00000c09b2010000043909ae000000100979000000043a09ae0000001409d7020000043b09ae000000180924010000043c09ae0000001c09"
            "42020000043d09ae00000020095c030000044009ae00000024091a030000044109ae00000028091d000000044209ae0000002c0931010000"
            "044416540200003009f70200000446145a0200003409ef02000004480767000000380930030000044907670000003c09d5010000044a0b8d"
            "00000040098f010000044d124b0000004409c6010000044e0f59000000460922020000044f086002000047097401000004510f7002000048"
            "09d901000004590da00000004c093b030000045b177b020000540901030000045c1986020000580978020000045d145a0200005c09470100"
            "00045e09ac000000600986020000045f0a2500000064090c0300000460076700000068092c0200000462088c0200006c0002040000000507"
            "19b40000000ae0030000042b0e0b1702000007044f0200000704b40000000c38000000700200000d3100000000000704470200000b380300"
            "000704760200000bfe0200000704810200000c380000009c0200000d3100000027000e2a03000006890ea802000007043b0200000ec70300"
            "00068a0ea80200000e54010000068b0ea80200000e14000000071a0c670000000ce8020000dd0200000f0004d202000007043f00000004e2"
            "0200000e6a030000071b1add020000030c04e1010000031004520300000cae000000170300000d3100000001000e3b000000089f0e070300"
            "000e7a01000008a00c670000000e6901000008a111990000000e3d00000008a60e070300000e7c01000008ae0c670000000e6b01000008af"
            "11990000000ece030000096d126e0000000e4e020000096e126e0000000e66020000096f126e0000000e8d02000009740c670000000ea601"
            "000009750c670000000e9b01000009760c670000000e090000000a370c670000000e440000000a380fbf0300000704ae0000001061020000"
            "01520567000000621400006f000000019cfe03000011fb01000001520e6700000002910011c101000001521bbf0300000291040012ab0200"
            "000118062d14000035000000019c240400001307030000011a0b2404000002916c0007046700000000011101250e130b030e1b0e11011206"
            "10170000021600030e3a0b3b0b390b491300000324000b0b3e0b030e0000042600491300000524000b0b3e0b03080000060f000b0b000007"
            "0f000b0b49130000081301030e0b0b3a0b3b0b390b01130000090d00030e3a0b3b0b390b4913380b00000a1600030e3a0b3b0b390b00000b"
            "1300030e3c1900000c01014913011300000d210049132f0b00000e3400030e3a0b3b0b390b49133f193c1900000f21000000102e013f1903"
            "0e3a0b3b0b390b2719491311011206401896421901130000110500030e3a0b3b0b390b491302180000122e013f19030e3a0b3b0b390b1101"
            "1206401896421901130000133400030e3a0b3b0b390b491302180000006b0100000300340100000101fb0e0d000101010100000001000001"
            "2f7573722f6c69622f6763632f7838365f36342d6c696e75782d676e752f392f696e636c756465002f7573722f696e636c7564652f626974"
            "73002f7573722f696e636c7564652f626974732f7479706573002f7573722f696e636c756465002e2e2f2e2e2f7465737463617365737570"
            "706f727400004357453437365f4e554c4c5f506f696e7465725f44657265666572656e63655f5f696e745f30312e63000000007374646465"
            "662e680001000074797065732e68000200007374727563745f46494c452e680003000046494c452e6800030000737464696f2e6800040000"
            "7379735f6572726c6973742e680002000074696d652e68000400007374645f74657374636173652e68000500007374645f74657374636173"
            "655f696f2e68000500000005010005022d140000031801050a084d0505760501082f033466051608ca0505c8c1082159050c082205015902"
            "0a0001015f494f5f46494c4500676c6f62616c41726763007379735f6e657272005f494f5f736176655f656e640073686f727420696e7400"
            "73697a655f74005f5f747a6e616d6500676c6f62616c41726776004357453437365f4e554c4c5f506f696e7465725f44657265666572656e"
            "63655f5f696e745f30312e63005f494f5f77726974655f707472005f666c61677300474e552043313720392e332e30202d6d3332202d6d74"
            "756e653d67656e65726963202d6d617263683d69363836202d67202d66504943202d666173796e6368726f6e6f75732d756e77696e642d74"
            "61626c6573202d66737461636b2d70726f746563746f722d7374726f6e67202d66737461636b2d636c6173682d70726f74656374696f6e20"
            "2d6663662d70726f74656374696f6e005f494f5f6275665f62617365005f6d61726b657273005f494f5f726561645f656e64005f66726565"
            "7265735f62756600737464657272006c6f6e67206c6f6e6720696e74005f5f74696d657a6f6e65005f6c6f636b005f5f6461796c69676874"
            "005f5f696e7436345f74005f6375725f636f6c756d6e00676c6f62616c4669766500676c6f62616c46616c7365005f494f5f77726974655f"
            "626173650061726776005f767461626c655f6f6666736574005f6f6c645f6f6666736574006c6f6e6720646f75626c6500756e7369676e65"
            "6420636861720061726763006c6f6e67206c6f6e6720756e7369676e656420696e74005f494f5f6d61726b6572005f73686f727462756600"
            "5f756e7573656432005f494f5f726561645f707472005f494f5f6275665f656e6400474c4f42414c5f434f4e53545f46414c5345006d6169"
            "6e00474c4f42414c5f434f4e53545f46495645005f667265657265735f6c697374005f5f7061643500676c6f62616c547275650073686f72"
            "7420756e7369676e656420696e74004357453437365f4e554c4c5f506f696e7465725f44657265666572656e63655f5f696e745f30315f62"
            "6164005f494f5f77726974655f656e64005f5f6f666636345f74005f66696c656e6f005f636861696e005f494f5f776964655f6461746100"
            "5f6d6f6465005f5f6f66665f74005f494f5f6261636b75705f6261736500737464696e005f666c61677332005f494f5f636f646563767400"
            "5f494f5f726561645f62617365005f466c6f6174313238005f494f5f736176655f62617365007379735f6572726c697374002f686f6d652f"
            "6d61747a6b652f47532d4341442f524f53452f4a756c6965742f736f757263652f7465737463617365732f4357453437365f4e554c4c5f50"
            "6f696e7465725f44657265666572656e6365007374646f757400474c4f42414c5f434f4e53545f54525545005f494f5f6c6f636b5f740000"
            "0000000000000000000000000000000000000000b4010000000000000300010000000000c8010000000000000300020000000000ec010000"
            "0000000003000300000000000802000000000000030004000000000028020000000000000300050000000000480200000000000003000600"
            "00000000f8030000000000000300070000000000b8050000000000000300080000000000f005000000000000030009000000000090060000"
            "0000000003000a0000000000d00600000000000003000b0000000000001000000000000003000c0000000000301000000000000003000d00"
            "00000000901100000000000003000e0000000000a01100000000000003000f0000000000f0120000000000000300100000000000381f0000"
            "000000000300110000000000002000000000000003001200000000009c200000000000000300130000000000702200000000000003001400"
            "00000000843e0000000000000300150000000000883e00000000000003001600000000008c3e00000000000003001700000000008c3f0000"
            "00000000030018000000000000400000000000000300190000000000104000000000000003001a0000000000000000000000000003001b00"
            "00000000000000000000000003001c0000000000000000000000000003001d0000000000000000000000000003001e000000000000000000"
            "0000000003001f00000000000000000000000000030020000100000000000000000000000400f1ff0c000000401300000000000002001000"
            "0e00000080130000000000000200100021000000d0130000000000000200100037000000104000000100000001001a0046000000883e0000"
            "00000000010016006d00000020140000000000000200100079000000843e000000000000010015009800000000000000000000000400f1ff"
            "c200000000000000000000000400f1ffc700000000000000000000000400f1ffd4000000ef1b00003b000000020010000100000000000000"
            "000000000400f1ffe3000000042a000000000000010014000000000000000000000000000400f1fff1000000883e00000000000000001500"
            "020100008c3e000000000000010017000b010000843e000000000000000015001e0100009c2000000000000000001300310100008c3f0000"
            "000000000100180020050000001000000000000002000c0047010000101f0000050000001200100057010000000000000000000012000000"
            "77010000161600004100000012001000890100008c170000410000001200100099010000982000000400000011001200ab01000000000000"
            "0000000012000000cc010000000000000000000020000000e801000030130000040000001202100044040000004000000000000020001900"
            "fe0100005a1a00002d000000120010001702000000000000000000001200000029020000421a000018000000120010003c02000052170000"
            "3a0000001200100055020000151f000000000000120210006b020000000000000000000012000000800200002a1c0000c700000012001000"
            "90020000000000000000000012000000a0020000871a00001400000012001000a6020000571600003200000012001000b5020000ff1a0000"
            "1400000012001000bb020000271b00001400000012001000c1020000af1a00001400000012001000c7020000d71a00001400000012001000"
            "cd020000000000000000000012000000eb020000104000000000000010001900f20200000000000000000000120000000203000008400000"
            "04000000110019000d030000ab150000390000001200100051010000381f000000000000120211001c030000000000000000000012000000"
            "38030000144000000400000011001a00440300003b1b0000140000001200100049030000631b000014000000120010004e0300008b1b0000"
            "140000001200100053030000db1b0000140000001200100058030000b31b000014000000120010005d030000000000000000000012000000"
            "7b0300000000000000000000120000008e0300001c4000000400000011001a0099030000291400000000000012021000af03000000000000"
            "0000000022000000cb0300005b1e00003900000012001000e00300002a1a00001800000012001000f2030000c31600005d00000012001000"
            "0104000094200000040000001100120014040000000000000000000012000000300400000000000000000000120000004204000000400000"
            "00000000100019004f0400000000000000000000120000005f040000031e00002c0000001200100074040000000000000000000020000000"
            "83040000841d00007f0000001200100097040000044000000000000011021900a4040000cd1700003c00000012001000b404000004200000"
            "0400000011001200c3040000000000000000000012000000d404000055190000d500000012001000e4040000000000000000000012000000"
            "010500002f1e00002c0000001200100016050000a01e0000650000001200100026050000000000000000000012000000410500002d140000"
            "3500000012001000fd000000204000000000000010001a0048040000f01200003a000000120010006d050000002000000400000011001200"
            "74050000131b000014000000120010007a0500000c400000040000001100190085050000eb1a000014000000120010008b050000c31a0000"
            "1400000012001000910500009b1a0000140000001200100097050000551d00002f00000012001000c4040000000000000000000012000000"
            "a8050000104000000000000010001a00b4050000000000000000000012000000cc050000621400006f00000012001000d1050000d1140000"
            "0000000012021000e7050000891600003a00000012001000f8050000f11c0000640000001200100006060000201700003200000012001000"
            "180600004f1b000014000000120010001d060000771b00001400000012001000220600009f1b00001400000012001000270600003e150000"
            "320000001200100034060000184000000400000011001a003f060000c71b0000140000001200100044060000061500003800000012001000"
            "4f060000201f00001800000012021000660600000000000000000000120000007e0600000918000064000000120010008d060000d5140000"
            "310000001200100097060000104000000000000011021900a3060000000000000000000012000000bd060000000000000000000020000000"
            "d7060000902000000400000011001200e90600006d180000e800000012001000f8060000e415000032000000120010000607000070150000"
            "3b00000012001000150700000000000000000000120000000063727473747566662e6300646572656769737465725f746d5f636c6f6e6573"
            "005f5f646f5f676c6f62616c5f64746f72735f61757800636f6d706c657465642e37363232005f5f646f5f676c6f62616c5f64746f72735f"
            "6175785f66696e695f61727261795f656e747279006672616d655f64756d6d79005f5f6672616d655f64756d6d795f696e69745f61727261"
            "795f656e747279004357453437365f4e554c4c5f506f696e7465725f44657265666572656e63655f5f696e745f30312e6300696f2e630073"
            "74645f7468726561642e6300696e7465726e616c5f7374617274005f5f4652414d455f454e445f5f005f5f696e69745f61727261795f656e"
            "64005f44594e414d4943005f5f696e69745f61727261795f7374617274005f5f474e555f45485f4652414d455f484452005f474c4f42414c"
            "5f4f46465345545f5441424c455f005f5f6c6962635f6373755f66696e6900707468726561645f6d757465785f756e6c6f636b4040474c49"
            "42435f322e30007072696e744c6f6e674c6f6e674c696e65007072696e74446f75626c654c696e6500474c4f42414c5f434f4e53545f4649"
            "564500707468726561645f6d757465785f64657374726f794040474c4942435f322e30005f49544d5f64657265676973746572544d436c6f"
            "6e655461626c65005f5f7838362e6765745f70635f7468756e6b2e627800676c6f62616c52657475726e73547275654f7246616c73650070"
            "72696e74664040474c4942435f322e3000676c6f62616c52657475726e7346616c7365007072696e74486578556e7369676e656443686172"
            "4c696e65005f5f7838362e6765745f70635f7468756e6b2e6270006973777864696769744040474c4942435f322e30007374645468726561"
            "6443726561746500667265654040474c4942435f322e3000676f6f6431007072696e7453697a65544c696e6500676f6f643700676f6f6439"
            "00676f6f643300676f6f643500707468726561645f6d757465785f696e69744040474c4942435f322e30005f65646174610074696d654040"
            "474c4942435f322e3000676c6f62616c54727565007072696e74466c6f61744c696e65005f5f737461636b5f63686b5f6661696c4040474c"
            "4942435f322e3400676c6f62616c46616c73650062616431006261643300626164350062616439006261643700707468726561645f6d7574"
            "65785f6c6f636b4040474c4942435f322e3000777072696e74664040474c4942435f322e3200676c6f62616c41726776005f5f7838362e67"
            "65745f70635f7468756e6b2e6478005f5f6378615f66696e616c697a654040474c4942435f322e312e33007374645468726561644c6f636b"
            "44657374726f7900676c6f62616c52657475726e7354727565007072696e7457636861724c696e6500474c4f42414c5f434f4e53545f4641"
            "4c5345005f5f69736f6339395f73777363616e664040474c4942435f322e37006d616c6c6f634040474c4942435f322e30005f5f64617461"
            "5f737461727400707574734040474c4942435f322e30007374645468726561644c6f636b41637175697265005f5f676d6f6e5f7374617274"
            "5f5f007374645468726561644c6f636b437265617465005f5f64736f5f68616e646c65007072696e745374727563744c696e65005f494f5f"
            "737464696e5f75736564007372616e644040474c4942435f322e30006465636f6465486578574368617273005f5f6c6962635f7374617274"
            "5f6d61696e4040474c4942435f322e30007374645468726561644c6f636b52656c65617365005f5f6c6962635f6373755f696e6974005f5f"
            "69736f6339395f737363616e664040474c4942435f322e37004357453437365f4e554c4c5f506f696e7465725f44657265666572656e6365"
            "5f5f696e745f30315f626164005f66705f687700676f6f643800676c6f62616c4669766500676f6f643600676f6f643400676f6f64320073"
            "746454687265616444657374726f79005f5f6273735f737461727400707468726561645f657869744040474c4942435f322e30006d61696e"
            "005f5f7838362e6765745f70635f7468756e6b2e6178007072696e74486578436861724c696e65007374645468726561644a6f696e007072"
            "696e74556e7369676e65644c696e65006261643200626164340062616436007072696e74496e744c696e6500676c6f62616c417267630062"
            "616438007072696e74574c696e65005f5f737461636b5f63686b5f6661696c5f6c6f63616c00707468726561645f6a6f696e4040474c4942"
            "435f322e30007072696e7442797465734c696e65007072696e744c696e65005f5f544d435f454e445f5f00707468726561645f6372656174"
            "654040474c4942435f322e31005f49544d5f7265676973746572544d436c6f6e655461626c6500474c4f42414c5f434f4e53545f54525545"
            "006465636f64654865784368617273007072696e744c6f6e674c696e65007072696e7453686f72744c696e65005f5f63747970655f625f6c"
            "6f634040474c4942435f322e3300002e73796d746162002e737472746162002e7368737472746162002e696e74657270002e6e6f74652e67"
            "6e752e6275696c642d6964002e6e6f74652e676e752e70726f7065727479002e6e6f74652e4142492d746167002e676e752e68617368002e"
            "64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c2e64796e002e72656c"
            "2e706c74002e696e6974002e706c742e676f74002e706c742e736563002e74657874002e66696e69002e726f64617461002e65685f667261"
            "6d655f686472002e65685f6672616d65002e696e69745f6172726179002e66696e695f6172726179002e64796e616d6963002e6461746100"
            "2e627373002e636f6d6d656e74002e64656275675f6172616e676573002e64656275675f696e666f002e64656275675f616262726576002e"
            "64656275675f6c696e65002e64656275675f7374720000000000000000000000000000000000000000000000000000000000000000000000"
            "00000000000000001b0000000100000002000000b4010000b401000013000000000000000000000001000000000000002300000007000000"
            "02000000c8010000c80100002400000000000000000000000400000000000000360000000700000002000000ec010000ec0100001c000000"
            "0000000000000000040000000000000049000000070000000200000008020000080200002000000000000000000000000400000000000000"
            "57000000f6ffff6f0200000028020000280200002000000006000000000000000400000004000000610000000b0000000200000048020000"
            "48020000b001000007000000010000000400000010000000690000000300000002000000f8030000f8030000c00100000000000000000000"
            "010000000000000071000000ffffff6f02000000b8050000b805000036000000060000000000000002000000020000007e000000feffff6f"
            "02000000f0050000f0050000a0000000070000000200000004000000000000008d0000000900000002000000900600009006000040000000"
            "06000000000000000400000008000000960000000900000042000000d0060000d0060000a800000006000000180000000400000008000000"
            "9f0000000100000006000000001000000010000024000000000000000000000004000000000000009a000000010000000600000030100000"
            "301000006001000000000000000000001000000004000000a500000001000000060000009011000090110000100000000000000000000000"
            "1000000010000000ae0000000100000006000000a0110000a01100005001000000000000000000001000000010000000b700000001000000"
            "06000000f0120000f0120000480c000000000000000000001000000000000000bd0000000100000006000000381f0000381f000018000000"
            "00000000000000000400000000000000c3000000010000000200000000200000002000009c00000000000000000000000400000000000000"
            "cb00000001000000020000009c2000009c200000d401000000000000000000000400000000000000d9000000010000000200000070220000"
            "702200009807000000000000000000000400000000000000e30000000e00000003000000843e0000842e0000040000000000000000000000"
            "0400000004000000ef0000000f00000003000000883e0000882e00000400000000000000000000000400000004000000fb00000006000000"
            "030000008c3e00008c2e00000001000007000000000000000400000008000000a900000001000000030000008c3f00008c2f000074000000"
            "0000000000000000040000000400000004010000010000000300000000400000003000001000000000000000000000000400000000000000"
            "0a0100000800000003000000104000001030000010000000000000000000000004000000000000000f010000010000003000000000000000"
            "103000004e00000000000000000000000100000001000000180100000100000000000000000000005e300000200000000000000000000000"
            "0100000000000000270100000100000000000000000000007e3000002b040000000000000000000001000000000000003301000001000000"
            "0000000000000000a93400000c0100000000000000000000010000000000000041010000010000000000000000000000b53500006f010000"
            "000000000000000001000000000000004d01000001000000300000000000000024370000eb03000000000000000000000100000001000000"
            "01000000020000000000000000000000103b0000800900002200000036000000040000001000000009000000030000000000000000000000"
            "904400002e0700000000000000000000010000000000000011000000030000000000000000000000be4b0000580100000000000000000000"
            "0100000000000000");





        char ch1 = '\0', ch2 = '\0';
        while (hexadecimal.get(ch1).get(ch2)) {
            const uint8_t byte = (*Sawyer::toDigit<uint8_t>(ch1, 16) << 4) | *Sawyer::toDigit<uint8_t>(ch2, 16);
            elfFile.stream().put(byte);
        }
        elfFile.stream().close();
        ASSERT_always_require2(elfFile.stream(),
                               "failed to write data to \"" + StringUtility::cEscape(elfFile.name().string()) + "\"");
    }
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
int
main(int argc, char *argv[]) {
    // Initialize
    ROSE_INITIALIZE;
    Diagnostics::initAndRegister(&mlog, "tool");
    mlog.comment("read-write sets");

    // Parse command-line
    Rose::CommandLine::insertSelfTest<SelfTest>();
    Settings settings;
    Sawyer::CommandLine::Parser parser = createSwitchParser(settings);
    P2::Engine::Ptr engine = P2::Engine::forge(argc, argv, parser /*in,out*/);
    std::vector<std::string> specimen = parser.parse(argc, argv).apply().unreachedArgs();
    mlog[INFO] <<"using the " <<engine->name() <<" partitioning engine\n";
    if (specimen.empty()) {
        mlog[FATAL] <<"no binary specimen specified; see --help\n";
        exit(1);
    }
    P2::Partitioner::Ptr partitioner = engine->partition(specimen);

    // Choose functions on which to run the analysis.
    const std::vector<P2::Function::Ptr> functions = [&settings, &partitioner]() {
        if (settings.functionNames.empty()) {
            return partitioner->functions();
        } else {
            return Bat::selectFunctionsByNameOrAddress(partitioner->functions(), settings.functionNames, mlog[WARN]);
        }
    }();
    mlog[INFO] <<"processing " <<StringUtility::plural(functions.size(), "functons") <<"\n";

    // Process each function
    for (const P2::Function::Ptr &function: functions) {
        std::cout <<"Variables for " <<function->printableName() <<"\n";
        auto rwSets = ReadWriteSets::instance(partitioner, settings.rwSets);
        rwSets->analyze(function);

#if 0 // [Robb Matzke 2024-10-10]
        // Print everything about the rwsets
        std::cout <<*rwSets;
#endif

        // Print the variables that are read and written
        std::cout <<"  local variables that are read and written:\n";
        const auto rw = Variables::AccessFlags(Variables::Access::READ).set(Variables::Access::WRITE);
        for (const Variables::StackVariable &svar: rwSets->localVariables(rw)) {
            std::cout <<"    " <<svar <<"\n";
            for (const Variables::InstructionAccess &ia: svar.instructionsAccessing())
                std::cout <<"      " <<ia <<"\n";
        }

        // Print the variables that are written but not read
        std::cout <<"  local variables that are written but never read:\n";
        for (const Variables::StackVariable &svar: rwSets->localVariables(Variables::Access::WRITE, Variables::Access::READ)) {
            std::cout <<"    " <<svar <<"\n";
            for (const Variables::InstructionAccess &ia: svar.instructionsAccessing())
                std::cout <<"      " <<ia <<"\n";
        }
    }
}
